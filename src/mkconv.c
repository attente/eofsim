/*
 * Copyright Â© 2007 Ryan Lortie
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of version 3 of the GNU General Public License as
 * published by the Free Software Foundation.
 *
 * See the included COPYING file for more information.
 */

#include <stdio.h>
#include <math.h>

double int_to_float_table[] = 
{
  [40] = 158.0,
  [41] = 158.0,
  [42] = 155.6,
  [43] = 153.3,
  [44] = 151.3,
  [45] = 149.0,
  [46] = 146.6,
  [47] = 144.3,
  [48] = 142.5,
  [49] = 140.3,
  [50] = 138.2,
  [51] = 136.4,
  [52] = 134.0,
  [53] = 133.5,
  [54] = 131.7,
  [55] = 130.4,
  [56] = 128.8,
  [57] = 127.3,
  [58] = 125.7,
  [59] = 124.5,
  [60] = 123.0,
  [61] = 121.4,
  [62] = 119.8,
  [63] = 118.5,
  [64] = 117.3,
  [65] = 116.2,
  [66] = 115.1,
  [67] = 114.1,
  [68] = 113.0,
  [69] = 111.9,
  [70] = 111.0,
  [71] = 110.1,
  [72] = 109.0,
  [73] = 108.1,
  [74] = 107.0,
  [75] = 105.9,
  [76] = 104.9,
  [77] = 104.0,
  [78] = 103.1,
  [79] = 102.0,
  [80] = 101.2,
  [81] = 100.2,
  [82] = 99.3,
  [83] = 98.2,
  [84] = 97.3,
  [85] = 96.4,
  [86] = 95.5,
  [87] = 94.6,
  [88] = 94.0,
  [89] = 93.2,
  [90] = 92.3,
  [91] = 91.7,
  [92] = 90.8,
  [93] = 90.1,
  [94] = 89.2,
  [95] = 88.5,
  [96] = 87.7,
  [97] = 87.0,
  [98] = 86.3,
  [99] = 85.6,
  [100] = 84.7,
  [101] = 84.2,
  [102] = 83.3,
  [103] = 82.7,
  [104] = 82.2,
  [105] = 81.6,
  [106] = 80.9,
  [107] = 80.2,
  [108] = 79.7,
  [109] = 79.0,
  [110] = 78.4,
  [111] = 77.7,
  [112] = 77.1,
  [113] = 76.6,
  [114] = 76.1,
  [115] = 75.4,
  [116] = 74.6,
  [117] = 74.1,
  [118] = 73.5,
  [119] = 73.0,
  [120] = 72.3,
  [121] = 71.6,
  [122] = 71.2,
  [123] = 70.6,
  [124] = 70.0,
  [125] = 69.2,
  [126] = 68.7,
  [127] = 68.2,
  [128] = 67.8,
  [129] = 67.1,
  [130] = 66.4,
  [131] = 66.0,
  [132] = 65.3,
  [133] = 64.7,
  [134] = 64.4,
  [135] = 63.6,
  [136] = 63.1,
  [137] = 62.5,
  [138] = 62.0,
  [139] = 61.3,
  [140] = 60.8,
  [141] = 60.2,
  [142] = 59.7,
  [143] = 59.1,
  [144] = 58.6,
  [145] = 58.1,
  [146] = 57.5,
  [147] = 57.0,
  [148] = 56.4,
  [149] = 55.7,
  [150] = 55.3,
  [151] = 54.7,
  [152] = 54.2,
  [153] = 53.6,
  [154] = 53.0,
  [155] = 52.5,
  [156] = 51.9,
  [157] = 51.4,
  [158] = 51.0,
  [159] = 50.5,
  [160] = 49.8,
  [161] = 49.2,
  [162] = 48.7,
  [163] = 48.2,
  [164] = 47.8,
  [165] = 47.1,
  [166] = 46.5,
  [167] = 46.0,
  [168] = 45.5,
  [169] = 45.1,
  [170] = 44.4,
  [171] = 43.8,
  [172] = 43.3,
  [173] = 42.8,
  [174] = 42.0,
  [175] = 41.7,
  [176] = 41.1,
  [177] = 40.6,
  [178] = 40.2,
  [179] = 39.7,
  [180] = 39.0,
  [181] = 38.4,
  [182] = 37.9,
  [183] = 37.5,
  [184] = 37.0,
  [185] = 36.3,
  [186] = 35.8,
  [187] = 35.4,
  [188] = 34.8,
  [189] = 34.3,
  [190] = 33.6,
  [191] = 33.2,
  [192] = 32.7,
  [193] = 32.0,
  [194] = 31.5,
  [195] = 30.8,
  [196] = 30.1,
  [197] = 29.5,
  [198] = 28.8,
  [199] = 28.1,
  [200] = 27.4,
  [201] = 26.6,
  [202] = 25.9,
  [203] = 25.2,
  [204] = 24.6,
  [205] = 24.0,
  [206] = 23.2,
  [207] = 22.7,
  [208] = 22.0,
  [209] = 21.2,
  [210] = 20.5,
  [211] = 19.9,
  [212] = 18.9,
  [213] = 18.2,
  [214] = 17.8,
  [215] = 16.7,
  [216] = 16.2,
  [217] = 15.5,
  [218] = 14.8,
  [219] = 14.2,
  [220] = 13.2,
  [221] = 12.6,
  [222] = 11.9,
  [223] = 11.2,
  [224] = 10.6,
  [225] = 9.0,
  [226] = 8.1,
  [227] = 7.0,
  [228] = 6.1,
  [229] = 5.2,
  [230] = 4.3,
  [231] = 3.3,
  [232] = 2.4,
  [233] = 1.3,
  [234] = 0.2,
  [235] = 0.0
};

int
main (void)
{
  int i;

  printf ("#include \"conversion.h\"\n\n");
  printf ("const unsigned char analog_to_digital[] =\n{\n");

  for (i = 0; i <= 1500; i++)
  {
    double value = i / 10.0;
    double minerr;
    int best, j;

    minerr = fabs (int_to_float_table[40] - value);
    best = 40;

    for (j = 41; j < 236; j++)
    {
      double err = fabs (int_to_float_table[j] - value);

      if (err < minerr)
      {
        minerr = err;
        best = j;
      }
    }

    printf ("  [%d] = %d%s\n", i, best, i < 1500 ? "," : "");
  }

  printf ("};\n");

  return 0;
}
